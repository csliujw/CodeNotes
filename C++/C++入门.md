# C++介绍

C++ 语言是在优化 C 语言的基础上为支持面向对象的程序设计而研制的一个通用目的的程序设计语言。在后来的持续研究中，C++ 增加了许多新概念，例如虚函数、重载、继承、标准模板库、异常处理、命名空间等。

## C++的特点

C++ 语言的特点主要表现在两个方面： <b>全面兼容 C 语言和支持面向对象的方法</b>。

由于 C++ 可以全面兼容 C，这就使得部分由 C 语言编写的代码在未经修改的情况下就可以为 C++ 所用，这极大的促进了 C++ 的普及和面向对象技术的广泛应用。

C++ 最具有意义的一面就是支持面向对象的方法。与 C 兼容的特点虽赋予 C++ 双重特点，但 C 和 C++ 在概念上却是两种完全不同的程序设计语言，所以在 C++ 中应注意按照面向对象的思维去编写代码。

此外，C++ 在保持 C 简洁、高效等特点的基础上，对 C 的类型系统进行改革和扩充，因此 C++ 编译环境能检测出的类型错误更多。

## 命名空间

命名空间里面包含了逻辑结构上相互关联的一组类、函数、模板等。命名空间像是一个容器，把某些在逻辑结构上相关的 “ 对象 ” 放在一起并与外界区分。特别的，命名空间里的变量名或类名可以和命名空间外的变量名或类名重名。

使用命名空间的时候，我们可以用<b>花括号</b>把声明块括起来，再以关键字 <b>namespace</b> 开头并命名，其基本格式如下：

```cpp
namespace Names{
    // 声明块
    int x;
    void funA(){
        //...
    }
}
```

## Hello World

```cpp
#include <iostream> //iostream 表示对流运行读写操作。
using namespace std; //使用标准 C++ 库中的所有成员。

int main(){
    cout << "Hello" << endl; //cout 为标准输出流对象；endl 表示插入换行符，并刷新流。
    return 0;
}
```

完成代码编写并成功保存后，在 Linux 终端输入：

```shell
g++ shiyanlou.cpp -o shiyanlou
```

GCC 和 G++ 是由 GNU 开发的编程语言编译器，其中 GCC 用来编译 C 语言程序；G++ 用来编译 C++ 语言程序。

g++ -o 的功能：生成可执行文件，其基本格式为:

```
g++ 需生成可执行文件的源文件名 -o 可执行文件名称
```

所以输入 `g++ shiyanlou.cpp -o shiyanlou` 命令且回车后，我们可以在代码文件浏览区看到生成的可执行文件 Hello。

# 基本数据类型及表达式

C++ 的数据类型分为基本数据类型和自定义数据类型，其基本数据类型如下：

| 数据类型名     | 长度（字节） | 取值范围                                                     |
| -------------- | ------------ | ------------------------------------------------------------ |
| char           | 1            | -128 ~ 127 或 0 ~ 255                                        |
| bool           | 1            | true, false                                                  |
| signed char    | 1            | -128 ~ 127                                                   |
| unsigned char  | 1            | 0 ~ 255                                                      |
| short          | 2            | -32768 ~ 32767                                               |
| unsigned short | 2            | 0 ~ 65535                                                    |
| int            | 4            | -2147483648 到 2147483647                                    |
| unsigned int   | 4            | 0 ~ 4294967295                                               |
| long           | 8            | -9223372036854775808 到 9223372036854775807                  |
| unsigned long  | 8            | 0 到 18,446,744,073,709,551,615                              |
| float          | 4            | 3.4E-38 ~ 3.4E+38                                            |
| double         | 8            | 1.7E-308 ~ 1.7E+308                                          |
| long double    | 16           | 长双精度型 16 个字节（128 位）内存空间，可提供 18-19 位有效数字。 |

各种类型的存储大小和具体操作系统的位数有关，目前大部分系统为 64 位，与上表基本一致。

由上表可知，C++ 的基本数据类型一般包括：bool、char、int、float 和 double。其中关键字 signed、unsigned、short、long 被称为修饰符。特别的，当用 short 或 long 修饰 int 时，int 可省略不写，表示短整型数据或长整型数据。

## string类

string 是 C++ 标准库的一个重要部分，主要用于字符串的处理，string 类的头文件为：`#include<string>`。使用 string 可以对字符串的对象执行某些操作，例如拼接、查找等。

## struct

struct 是由一系列相同或不同的数据类型组成的数据集合，也称结构体，是一种复合型的数据类型。

```cpp
struct struct_name
{
    memberList
}varList
```

其中 `struct` 为结构体的关键字，`struct_name` 为结构体的名字，`memberList` 为结构体成员变量及成员函数的列表，`varList` 为结构体声明的变量。使用 `varList.元素名`可调用结构体中的元素。

```cpp
#include<iostream>
using namespace std;

struct demo{
    int a;
    string info(){ 
        return a+"123"; 
    }
}d;

int main(){
    cout<<"before:"<< d.info()<<endl;
    d.a = 10;
    cout<<d.a<<endl;
}
```

```shell
xx:project/ $ g++ stru.cpp -o stru                                                                             [22:24:33]
xx:project/ $ ./stru                                                                                           [22:24:38]
before:123
10
xx:project/ $      
```

## 变量作用域

局部变量、全局变量和 Java 类似。不赘诉。

## 常量

常量声明一般有两种方式，一是使用 `#define` 预处理、二是使用 `const` 关键字。

1. 使用 `#define` 预处理

格式：#define name value

```c++
#define PI 3.14159
#define NEWLINE '\n'
```

1. 使用 `const` 关键字

格式：const type name = value

```c++
const double pi = 3.14;
const char tab = '\t';
```

# 内存分配

C++ 程序在运行时，计算机内存被分为程序代码区、全局数据区、堆区、栈区四个部分。本次实验共有两个内容，一是介绍 C++ 三种内存分配方式，二是使用 new 关键字和 delete 关键字管理堆内存。

- 静态存储分配
- 栈内存分配
- 堆内存分配
- new 关键字和 delete 关键字

## 内存分配的三种方式

不同的内存分配方式，有不同的内存调度机制。C++ 语言的三种内存分配方式分别是：静态存储区分配、栈内存分配和堆内存分配。

### 静态存储区分配

静态分配方式下的内存在程序编译的时候就已经分配好了且存在于程序的整个运行过程。例如 static 变量，其生命周期随程序的结束而结束，而非像一般变量随函数或作用域的结束而结束。

除了 static 变量，还有一种全局对象 static object，也可以存放在静态存储区。

### 栈内存分配

栈内存分配方式下的内存是存在于某作用域的一块空间。例如调用某个函数时，函数内局部变量的存储单元可以在栈上创建，函数执行结束时，这些内存单元会被自动释放。

函数内局部变量的生命周期：起于变量声明，止于函数执行结束。

### 堆内存分配

堆内存分配，也称<b>动态内存分配</b>，通常使用 new 和 delete 关键字进行管理。堆内存空间可由用户手动分配和释放，所以其生存周期由用户指定，较为灵活。但频繁的分配、释放大小不同的堆空间会产生内存碎片。

## 管理堆内存

C 语言中一般使用 malloc() 函数来分配内存空间，free() 函数来释放内存空间。但在 c++ 语言中我们使用 new 关键字来分配内存空间，delete 关键字来释放内存空间。

在学习使用 new 和 delete 关键字之前我们先初步了解一下指针的概念及其一般形式。

指针是一个变量，其值是另一个变量的地址。指针变量声明的一般形式为：

```
type *pointerVar-name
```

其中 `type` 为指针的数据类型，`*` 是定义指针的关键符，`pointerVar-name` 指定指针变量名。

例如：`char *p`，即定义了一个字符型指针变量 p。

指针的另一些基本内容会在后续的实验中详细介绍，本次实验对指针的内容仅做了解。现在我们正式学习 new 关键字和 delete 关键字。

<b>new 关键字</b>用于堆内存的分配，可自动计算所要分配内存空间的大小，其基本使用形式为：

```
指针变量名 = new 类型
```

例如：

```c++
int *p; //定义一个整型指针变量
p = new int;
```

其中 `p = new int;` 表示动态分配一个存放整型数据的内存空间，并将其首地址赋给整型指针变量 p，此时省略指针变量 p 前的 `*`。

<b>delete 关键字</b>用于堆内存的释放，其基本形式为：

```
delete 指针变量
```

例如：

```c++
int *p; //定义一个整型指针变量
p = new int;
//省略指针操作过程
delete p;
```

其中 `delete p;` 表示释放指针变量 p 指向的内存空间，此时省略指针变量 p 前的 `*`。

注意：使用 new 获取的内存空间必须使用 delete 进行释放。

我们用实例来加深一下 new 和 delete 关键字的使用方式，新建 `mans.cpp` 文件，输入：

```c++
#include <iostream>
using namespace std;

int main()
{
    int *p; //定义一个整型的指针变量 p。
    p = new int; //动态分配一个存放整型数据的内存空间，并将其首地址赋给整型指针变量 p。
    *p = 6; //为指针指向的内存块赋值为 6。
    cout<<*p<<endl; //输出内存块的赋值。
    delete p;//释放指针变量 p 指向的内存空间。
    return 0;
}
```

程序首先定义了整型指针变量 p，然后使用 new 关键字为其分配 int 型的内存空间，并让指针 p 指向分配的内存空间。随后为内存块赋值为 6，并且输出所赋的值。最后释放指针变量 p。