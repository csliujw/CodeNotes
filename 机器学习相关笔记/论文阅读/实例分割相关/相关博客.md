# <a href="https://cloud.tencent.com/developer/article/1594076?from=article.detail.1594081">实例分割综述</a>

## 概述

实例分割（Instance Segmentation）

- 需要像素层面上的分类
- 需要定位不同的实例，即便是同一种类别（具备目标检测的一部分特点）

<span style="color:green">**两种方式**</span>

- 自下而上的基于语义分割的方法
- 自上而下的基于检测的方法

## 两种方式

### 自下而上基于语义分割

首先进行像素级别的语义分割，再通过聚类、度量学习等手段区分不同的实例。这种方法虽然<span style="color:green">保持了更好的低层特征（细节信息和位置信息）</span>，但也存在以下缺点：

- 对密集分割的质量要求很高，**会导致非最优的分割**
- **泛化能力较差**，无法应对类别多的复杂场景（测评的场景类别不算多）
- **后处理**方法繁琐

### 自上而下基于检测

首先通过目标检测的方法找出实例所在的区域（bounding box），再<span style="color:green">在检测框内进行语义分割</span>，每个分割结果都作为一个不同的实例输出。

自上而下的密集实例分割的开山鼻祖是`DeepMask`，它通过滑动窗口的方法，在每个空间区域上都预测一个`mask proposal`。这个方法存在以下三个缺点：

- **mask与特征的联系（局部一致性）丢失了**，如`DeepMask`中使用全连接网络去提取mask
- **特征的提取表示是冗余的**， 如`DeepMask`对每个前景特征都会去提取一次mask
- **下采样**（使用步长大于1的卷积）导致的位置信息丢失

## 代表性方法

### 双阶段Mask R-CNN

`Mask-RCNN`通过增加不同的分支可以完成目标分类，目标检测，语义分割，实例分割，人体姿态估计等多种任务。对于实例分割来讲，就是**在`Faster-RCNN`的基础上(分类+回归分支)增加了一个分支用于语义分割**，其抽象结构如下图所示：

<img src="../../../pics/CV_blog/instance segment/mask_r-cnn.jpeg" style="float:left">

`ROI Align`是Mask R-CNN论文里提出的一种区域特征聚集方式, 很好地解决了ROI Pooling操作中两次量化造成的区域不匹配(mis-alignment)的问题。

<span style="color:green">**`ROI Pooling`**</span>：`ROI Pooling` 就是将大小不同的feature map 池化成大小相同的feature map，利于输出到下一层网络中.【ROI（region of interest）】

`ROI Poooling`具体操作如下：

<a href="https://blog.csdn.net/weixin_44638957/article/details/97144418?utm_medium=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.control&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.control">参考博客</a>

- 根据输入image，将ROI映射到feature map对应位置；
- 将映射后的区域划分为相同大小的sections（sections数量与输出的维度相同）；
- 对每个sections进行max pooling操作；
- <span style="color:green">本质上就是选好ROI后，区域的划分大小不一样，有些是$2*2$的区域做最大池化，有些是$3*3$的区域做最大池化。</span>

**`eg`：**

一个$8 * 8$的feature map，一个ROI，以及输出大小为$2*2$

- 输入固定大小的feature map

- region proposal投影之后位置（两个点分别在左上角，右下角坐标）（0，3）（7，8）

- 将其划分为（2*2）个sections（因为输出大小为2*2），我们可以得到

- 对每个section做max pooling，可以得到：

  <img src="../../../pics/CV_blog/instance segment/ROI_Pooling.webp" style="float:left">

